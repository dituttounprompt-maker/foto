<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendario 2026</title>
  <style>
    :root { --bg:#0e0e0e; --card:#1a1a1a; --txt:#fff; }
    *{box-sizing:border-box}
    body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--txt);margin:0;padding:20px;text-align:center}
    h1{margin:0 0 24px}

    /* grid */
    .gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;justify-items:center}
    .card{width:100%;max-width:520px;background:var(--card);border-radius:12px;padding:8px;box-shadow:0 0 10px rgba(0,0,0,.6);cursor:zoom-in}
    .card img{width:100%;height:auto;border-radius:8px;display:block}

    .name{margin:8px 0 4px;font-size:.95rem;opacity:.8;word-break:break-all}
    footer{margin-top:28px;font-size:.9rem;opacity:.7}

    /* MODAL */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.85);
      display:none;align-items:center;justify-content:center;z-index:9999}
    .lightbox[aria-hidden="false"]{display:flex}
    .lb-wrap{position:relative;max-width:95vw;max-height:90vh;display:flex;flex-direction:column;gap:10px}
    .lb-img{max-width:95vw;max-height:80vh;width:auto;height:auto;object-fit:contain;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.6)}
    .lb-caption{font-size:.95rem;opacity:.85;word-break:break-all;text-align:center}

    .lb-btn{position:absolute;top:8px;background:rgba(0,0,0,.55);border:0;color:#fff;
      width:42px;height:42px;border-radius:8px;cursor:pointer;font-size:20px}
    .lb-close{right:8px}
    .lb-prev,.lb-next{top:50%;transform:translateY(-50%);width:48px;height:64px;font-size:26px}
    .lb-prev{left:-64px}
    .lb-next{right:-64px}

    @media (max-width:700px){
      .lb-prev{left:6px}.lb-next{right:6px}
      .lb-btn{width:40px;height:40px}
    }
  </style>
</head>
<body>
  <h1>Calendario 2026</h1>
  <div id="gallery" class="gallery"></div>
  <div id="error" class="err"></div>
  <footer>© 2025 dittutounprompt-maker — © tutte le immagini</footer>

  <!-- Lightbox Modal -->
  <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-label="Immagine ingrandita">
    <button class="lb-btn lb-close" aria-label="Chiudi">✕</button>
    <button class="lb-btn lb-prev" aria-label="Precedente">❮</button>
    <div class="lb-wrap">
      <img id="lbImg" class="lb-img" alt="">
      <div id="lbCaption" class="lb-caption"></div>
    </div>
    <button class="lb-btn lb-next" aria-label="Successiva">❯</button>
  </div>

  <script>
    // Config
    const owner = "dituttounprompt-maker";
    const repo  = "foto";
    const path  = "foto"; // cartella con le immagini
    const exts  = new Set([".jpg",".jpeg",".png",".webp",".avif",".gif"]);

    const state = { files: [], idx: 0 };

    // Build gallery from GitHub API
    async function load() {
      try {
        const api = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
        const res = await fetch(api);
        if (!res.ok) throw new Error(`GitHub API ${res.status}`);
        const items = await res.json();

        state.files = items
          .filter(it => it.type === "file" && exts.has((it.name.match(/\.[^.]+$/)?.[0] || "").toLowerCase()))
          .sort((a,b) => a.name.localeCompare(b.name,'it'));

        const g = document.getElementById("gallery");
        state.files.forEach((f, i) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <img loading="lazy" src="${f.download_url}" alt="${f.name.replace(/\.[^.]+$/,'')}">
            <div class="name">${f.name.replace(/\.[^.]+$/,'')}</div>`;
          card.addEventListener("click", () => openLightbox(i));
          g.appendChild(card);
        });
      } catch (e) {
        document.getElementById("error").textContent = "Errore: " + e.message;
      }
    }

    // Lightbox controls
    const lb = document.getElementById("lightbox");
    const lbImg = document.getElementById("lbImg");
    const lbCaption = document.getElementById("lbCaption");

    function openLightbox(i){
      state.idx = i;
      const f = state.files[i];
      lbImg.src = f.download_url;
      lbImg.alt = f.name.replace(/\.[^.]+$/,'');
      lbCaption.textContent = lbImg.alt;
      lb.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function closeLightbox(){
      lb.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
      lbImg.src = "";
    }
    function next(){ if(!state.files.length) return; openLightbox((state.idx+1)%state.files.length); }
    function prev(){ if(!state.files.length) return; openLightbox((state.idx-1+state.files.length)%state.files.length); }

    // Events
    document.querySelector(".lb-close").onclick = closeLightbox;
    document.querySelector(".lb-next").onclick = next;
    document.querySelector(".lb-prev").onclick = prev;

    // click fuori dall'immagine
    lb.addEventListener("click", (e)=>{ if(e.target === lb) closeLightbox(); });

    // tastiera
    window.addEventListener("keydown", (e)=>{
      if(lb.getAttribute("aria-hidden")==="true") return;
      if(e.key === "Escape") closeLightbox();
      if(e.key === "ArrowRight") next();
      if(e.key === "ArrowLeft") prev();
    });

    // swipe mobile
    let sx=0;
    lb.addEventListener("touchstart",e=>{ sx = e.changedTouches[0].clientX; },{passive:true});
    lb.addEventListener("touchend",e=>{
      const dx = e.changedTouches[0].clientX - sx;
      if(Math.abs(dx) > 40) (dx<0?next:prev)();
    },{passive:true});

    load();
  </script>
</body>
</html>
